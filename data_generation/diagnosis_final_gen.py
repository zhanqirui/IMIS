import csv
import random

def generate_final_diagnosis_plan(output_file, intelligent_decision_file, doctor_adoption_file):
    # 定义列名
    final_columns = [
        "id",  # 主码
        "module_code",  # 模块代码，固定为 MSDATA
        "dept_id",  # 部门 ID，固定为 0000
        "final_diagnosis_plan",  # 最终诊疗方案
        "intelligent_decision_id",  # 智能决策 ID
        "medical_record_id"  # 病历 ID
    ]

    # 新生成的诊断意见库（100条）
    diagnosis_pool = [
        "建议患者服用中药汤剂以改善症状，同时定期复查。",
        "采用针灸辅助治疗，并结合抗炎药物控制病情。",
        "推荐患者进行饮食调整，结合药物治疗以稳定病情。",
        "通过中医刮痧疗法缓解疼痛，配合现代影像检查复查。",
        "建议患者进行康复锻炼，同时服用营养补充剂。",
        "采用中医经络调理治疗，结合抗病毒药物缓解病症。",
        "推荐患者进行心理咨询，同时配合中药调理改善睡眠。",
        "建议患者采用艾灸疗法以缓解慢性疼痛症状。",
        "推荐患者使用中药外敷治疗，同时配合药物管理病情。",
        "采用现代影像检查明确病因后结合中药调理。",
        "建议患者进行中医推拿辅助治疗，结合药物减少症状。",
        "通过中药熏蒸疗法缓解病症，建议定期复查。",
        "采用中药饮片调理脾胃功能，结合生活方式调整。",
        "建议患者进行温针疗法以缓解肌肉紧张。",
        "推荐患者定期复查，并结合中医药调理增强免疫力。",
        "建议患者通过中药治疗调节内分泌，结合手术改善病情。",
        "通过中药调理心肺功能，建议配合抗菌药物治疗。",
        "采用拔罐疗法结合物理治疗以改善肌肉劳损问题。",
        "建议患者通过中药汤剂治疗，同时进行心理疏导。",
        "通过中医针灸辅助治疗，结合抗抑郁药物缓解病情。",
        "采用现代放疗结合中医养生方法改善病症。",
        "建议患者进行饮食调整，并结合药物治疗以控制血糖。",
        "通过中药洗浴缓解疲劳，配合心理咨询改善睡眠质量。",
        "采用中药调理胃肠功能，结合抗生素治疗消化系统疾病。",
        "建议患者进行穴位按摩，配合药物治疗降低血压。",
        "通过中药调节肝功能，结合现代药物治疗减轻症状。",
        "采用中药与物理治疗设备相结合改善术后恢复效果。",
        "建议患者定期使用中药调理，结合影像复查确认疗效。",
        "通过针灸治疗缓解疼痛，配合药物控制症状。",
        "采用抗生素治疗结合中药辅助恢复胃肠功能。",
        "建议患者进行中医熏蒸以改善关节炎症状。",
        "通过中药治疗调节免疫功能，建议定期复查血象。",
        "采用中药与运动康复结合的方式治疗慢性病症。",
        "建议患者通过中医理疗辅助治疗腰椎间盘突出症。",
        "推荐患者使用中药调理，同时严格控制饮食。",
        "采用中药治疗结合物理治疗设备缓解病症。",
        "建议患者通过中药治疗调节身体机能，结合心理咨询改善情绪。",
        "通过中医按摩缓解病痛，结合现代影像检查复查。",
        "采用中药外敷结合药物治疗缓解病症。",
        "建议患者进行中医艾灸辅助治疗，结合药物减轻症状。",
        "通过中医药浴治疗改善病情，结合药物管理。",
        "采用中药治疗结合现代医疗设备复查确定疗效。",
        "推荐患者使用中药汤剂调节脾胃功能，结合生活方式调整。",
        "建议患者通过中医推拿调理身体机能，结合药物治疗缓解疼痛。",
        "通过中药调理血液循环，建议患者定期复查病情变化。",
        "采用中医治疗结合抗生素治疗以减轻症状。",
        "建议患者通过中药调节脾胃功能，结合饮食调整改善病情。",
        "通过中医拔罐缓解肌肉紧张，配合药物控制病情。",
        "推荐患者定期进行中医调理，结合药物治疗提升免疫力。",
        "采用中药调节身体机能结合心理咨询改善病情。",
        "建议患者通过中医艾灸缓解疼痛，同时定期复查病情。",
        "通过中药治疗调节免疫功能，结合药物治疗改善症状。",
        "采用中医推拿与物理康复相结合的治疗方案。",
        "建议患者通过中药外敷治疗，结合药物减轻病症。",
        "通过中药治疗调节免疫功能，结合生活方式调整。",
        "建议患者通过中药治疗缓解症状，结合抗抑郁药物治疗病情。",
        "通过中医针灸辅助治疗，结合心理干预改善病情。",
        "采用中药治疗结合现代影像检查复查确定病因。",
        "建议患者通过中药调理身体机能，结合药物治疗提升免疫力。",
        "采用中医针灸结合药物治疗缓解病情。",
        "通过中药治疗结合抗炎药物减轻症状。",
        "建议患者定期进行中医理疗，结合药物治疗减轻症状。",
        "通过中药治疗调节身体机能，结合心理干预改善病情。",
        "采用中医拔罐结合现代影像检查复查病情。",
        "建议患者通过中药治疗调节身体机能，结合心理干预改善症状。",
        "通过中医针灸辅助治疗，结合药物治疗减轻症状。",
        "采用中医调理结合现代检查手段复查病情变化。",
        "建议患者通过中药治疗提升免疫功能，结合药物治疗改善病情。",
        "通过中药治疗调节血液循环，结合药物治疗缓解病症。",
        "采用中医治疗结合抗炎药物缓解病情。",
        "建议患者通过中药调理身体机能，结合饮食调整提升免疫力。",
        "通过中药治疗缓解病症，结合抗抑郁药物改善情绪。",
        "建议患者定期进行中医调理，结合药物治疗提升免疫力。",
        "通过中药调理身体功能，结合心理咨询缓解病情。",
        "采用中药治疗结合药物管理缓解病症。",
        "建议患者通过中药治疗调节内分泌，结合现代检查手段确定疗效。",
        "通过中药治疗调节身体机能，结合抗菌药物控制病情。",
        "采用中药治疗结合心理干预缓解病情。",
        "建议患者通过中药治疗提升免疫功能，结合现代影像检查确定疗效。",
        "通过中药治疗调节免疫功能，结合抗抑郁药物改善情绪。",
        "采用中医调理结合现代影像检查复查病情变化。",
        "建议患者通过中药治疗提升免疫功能，结合药物治疗改善病情。",
        "通过中药治疗缓解病症，结合药物治疗提升免疫力。",
        "建议患者通过中药治疗调节内分泌，结合现代影像检查复查病情变化。",
        "通过中药治疗调节身体机能，结合抗炎药物缓解病情。",
        "采用中医拔罐结合抗抑郁药物改善病情。",
        "建议患者通过中药治疗缓解症状，结合药物管理病情。",
        "通过中药治疗调节免疫功能，结合药物治疗提升免疫力。",
        "采用中医针灸结合现代影像检查复查病情变化。",
        "建议患者通过中药治疗调节身体机能，结合饮食调整提升免疫力。",
        "通过中药治疗调节身体机能，结合抗炎药物缓解病情。",
        "采用中医调理结合现代检查手段复查病情变化。",
        "建议患者通过中药治疗提升免疫功能，结合药物治疗改善病情。",
        "通过中药治疗缓解病症，结合抗抑郁药物改善情绪。",
        "建议患者定期进行中医调理，结合药物治疗提升免疫力。",
        "通过中药治疗调节身体机能，结合心理咨询缓解病情。",
        "采用中药治疗结合药物管理缓解病症。",
        "建议患者通过中药治疗调节内分泌，结合现代检查手段确定疗效。",
        "通过中药治疗调节身体机能，结合抗菌药物控制病情。",
        "采用中药治疗结合心理干预缓解病情。",
        "建议患者通过中药治疗提升免疫功能，结合现代影像检查确定疗效。",
        "通过中药治疗调节免疫功能，结合抗抑郁药物改善情绪。",
        "采用中医调理结合现代影像检查复查病情变化。",
        "建议患者通过中药治疗提升免疫功能，结合药物治疗改善病情。",
        "通过中药治疗缓解病症，结合药物治疗提升免疫力。",
        "建议患者通过中药治疗调节内分泌，结合现代影像检查复查病情变化。",
        "通过中药治疗调节身体机能，结合抗炎药物缓解病情。",
        "采用中医拔罐结合抗抑郁药物改善病情。",
    ]

    # 读取智能决策数据
    with open(intelligent_decision_file, mode="r", encoding="utf-8") as decision_file:
        decision_reader = csv.DictReader(decision_file)
        intelligent_decisions = {row["id"]: row["integration_decision"] for row in decision_reader}

    # 读取采纳意见数据
    with open(doctor_adoption_file, mode="r", encoding="utf-8") as adoption_file:
        adoption_reader = csv.DictReader(adoption_file)
        adoptions = {row["intelligent_decision_id"]: row["positive_feedback"] for row in adoption_reader}

    # 写入最终诊疗意见到输出文件
    with open(output_file, mode="w", newline="", encoding="utf-8") as outfile:
        writer = csv.writer(outfile)
        writer.writerow(final_columns)

        record_id = 1
        for intelligent_decision_id, feedback in adoptions.items():
            medical_record_id = intelligent_decision_id.replace("INTELLI", "REC")
            final_diagnosis_plan = (intelligent_decisions[intelligent_decision_id]
                                    if feedback == "采纳"
                                    else random.choice(diagnosis_pool))

            row = [
                f"FD{record_id:06d}",  # id
                "MSDATA",  # module_code
                "0000",  # dept_id
                final_diagnosis_plan,  # final_diagnosis_plan
                intelligent_decision_id,  # intelligent_decision_id
                medical_record_id  # medical_record_id
            ]
            writer.writerow(row)
            record_id += 1

# 文件路径
folder_path = 'E:/C_codes/IMIS/IMIS/data_generation/data/'
intelligent_decision_file = "intelligent_decision.data"
doctor_adoption_file = "doctor_adoption_info.data"
output_file = "final_diagnosis_plan.data"

# 生成最终诊疗意见数据
generate_final_diagnosis_plan(folder_path+output_file, folder_path+intelligent_decision_file, folder_path+doctor_adoption_file)
print(f"最终诊疗意见数据已生成并保存至 {output_file}")
